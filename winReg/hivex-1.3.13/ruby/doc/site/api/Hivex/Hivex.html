<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Hivex::Hivex - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-close">#close</a>
    
    <li ><a href="#method-i-commit">#commit</a>
    
    <li ><a href="#method-i-last_modified">#last_modified</a>
    
    <li ><a href="#method-i-node_add_child">#node_add_child</a>
    
    <li ><a href="#method-i-node_children">#node_children</a>
    
    <li ><a href="#method-i-node_delete_child">#node_delete_child</a>
    
    <li ><a href="#method-i-node_get_child">#node_get_child</a>
    
    <li ><a href="#method-i-node_get_value">#node_get_value</a>
    
    <li ><a href="#method-i-node_name">#node_name</a>
    
    <li ><a href="#method-i-node_name_len">#node_name_len</a>
    
    <li ><a href="#method-i-node_parent">#node_parent</a>
    
    <li ><a href="#method-i-node_set_value">#node_set_value</a>
    
    <li ><a href="#method-i-node_set_values">#node_set_values</a>
    
    <li ><a href="#method-i-node_struct_length">#node_struct_length</a>
    
    <li ><a href="#method-i-node_timestamp">#node_timestamp</a>
    
    <li ><a href="#method-i-node_values">#node_values</a>
    
    <li ><a href="#method-i-root">#root</a>
    
    <li ><a href="#method-i-value_data_cell_offset">#value_data_cell_offset</a>
    
    <li ><a href="#method-i-value_dword">#value_dword</a>
    
    <li ><a href="#method-i-value_key">#value_key</a>
    
    <li ><a href="#method-i-value_key_len">#value_key_len</a>
    
    <li ><a href="#method-i-value_multiple_strings">#value_multiple_strings</a>
    
    <li ><a href="#method-i-value_qword">#value_qword</a>
    
    <li ><a href="#method-i-value_string">#value_string</a>
    
    <li ><a href="#method-i-value_struct_length">#value_struct_length</a>
    
    <li ><a href="#method-i-value_type">#value_type</a>
    
    <li ><a href="#method-i-value_value">#value_value</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Hivex::Hivex">
  <h1 id="class-Hivex::Hivex" class="class">
    class Hivex::Hivex
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-close" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            close() &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>close a hive handle</p>

<p>Close a hive handle and free all associated resources.</p>

<p>Note that any uncommitted writes are <strong>not</strong> committed by this
call, but instead are lost. See “WRITING TO HIVE FILES” in hivex(3).</p>

<p>(For the C API documentation for this function, see
<code>hivex_close[http://libguestfs.org/hivex.3.html#hivex_close]</code>).</p>
          
          

          
          <div class="method-source-code" id="close-source">
            <pre>static VALUE
ruby_hivex_close (VALUE hv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;close&quot;);

  int r;

  r = hivex_close (h);

  /* So we don&#39;t double-free in the finalizer. */
  DATA_PTR (hv) = NULL;

  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-commit" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            commit(filename) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>commit (write) changes to file</p>

<p>Commit (write) any changes which have been made.</p>

<p>“filename” is the new file to write. If “filename” is null/undefined then
we overwrite the original file (ie. the file name that was passed to
“h.open”).</p>

<p>Note this does not close the hive handle. You can perform further
operations on the hive after committing, including making more
modifications. If you no longer wish to use the hive, then you should close
the handle after committing.</p>

<p>(For the C API documentation for this function, see
<code>hivex_commit[http://libguestfs.org/hivex.3.html#hivex_commit]</code>).</p>
          
          

          
          <div class="method-source-code" id="commit-source">
            <pre>static VALUE
ruby_hivex_commit (VALUE hv, VALUE filenamev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;commit&quot;);
  const char *filename =
    !NIL_P (filenamev) ? StringValueCStr (filenamev) : NULL;

  int r;

  r = hivex_commit (h, filename, 0);

  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-last_modified" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            last_modified() &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the modification time from the header of the hive</p>

<p>Return the modification time from the header of the hive.</p>

<p>The returned value is a Windows filetime. To convert this to a Unix
“time_t” see: &lt;<a
href="http://stackoverflow.com/questions/6161776/convert-wind">stackoverflow.com/questions/6161776/convert-wind</a>
ows-filetime-to-second-in-unix-linux/6161842#6161842&gt;</p>

<p>(For the C API documentation for this function, see
<code>hivex_last_modified[http://libguestfs.org/hivex.3.html#hivex_last_modified]</code>).</p>
          
          

          
          <div class="method-source-code" id="last_modified-source">
            <pre>static VALUE
ruby_hivex_last_modified (VALUE hv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;last_modified&quot;);

  errno = 0;
  int64_t r;

  r = hivex_last_modified (h);

  if (r == -1 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_add_child" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_add_child(parent, name) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>add child node</p>

<p>Add a new child node named “name” to the existing node “parent”. The new
child initially has no subnodes and contains no keys or values. The
sk-record (security descriptor) is inherited from the parent.</p>

<p>The parent must not have an existing child called “name”, so if you want to
overwrite an existing child, call “h.node_delete_child” first.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_add_child[http://libguestfs.org/hivex.3.html#hivex_node_add_child]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_add_child-source">
            <pre>static VALUE
ruby_hivex_node_add_child (VALUE hv, VALUE parentv, VALUE namev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_add_child&quot;);
  hive_node_h parent = NUM2ULL (parentv);
  const char *name = StringValueCStr (namev);

  hive_node_h r;

  r = hivex_node_add_child (h, parent, name);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_children" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_children(node) &rarr; list
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return children of node</p>

<p>Return an array of nodes which are the subkeys (children) of “node”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_children[http://libguestfs.org/hivex.3.html#hivex_node_children]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_children-source">
            <pre>static VALUE
ruby_hivex_node_children (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_children&quot;);
  hive_node_h node = NUM2ULL (nodev);

  hive_node_h *r;

  r = hivex_node_children (h, node);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  size_t i, len = 0;
  for (i = 0; r[i] != 0; ++i) len++;
  VALUE rv = rb_ary_new2 (len);
  for (i = 0; r[i] != 0; ++i)
    rb_ary_push (rv, ULL2NUM (r[i]));
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_delete_child" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_delete_child(node) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>delete child node</p>

<p>Delete the node “node”. All values at the node and all subnodes are deleted
(recursively). The “node” handle and the handles of all subnodes become
invalid. You cannot delete the root node.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_delete_child[http://libguestfs.org/hivex.3.html#hivex_node_delete_child]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_delete_child-source">
            <pre>static VALUE
ruby_hivex_node_delete_child (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_delete_child&quot;);
  hive_node_h node = NUM2ULL (nodev);

  int r;

  r = hivex_node_delete_child (h, node);

  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_get_child" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_get_child(node, name) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return named child of node</p>

<p>Return the child of node with the name “name”, if it exists.</p>

<p>The name is matched case insensitively.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_get_child[http://libguestfs.org/hivex.3.html#hivex_node_get_child]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_get_child-source">
            <pre>static VALUE
ruby_hivex_node_get_child (VALUE hv, VALUE nodev, VALUE namev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_get_child&quot;);
  hive_node_h node = NUM2ULL (nodev);
  const char *name = StringValueCStr (namev);

  errno = 0;
  hive_node_h r;

  r = hivex_node_get_child (h, node, name);

  if (r == 0 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  if (r)
    return ULL2NUM (r);
  else
    return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_get_value" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_get_value(node, key) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return named key at node</p>

<p>Return the value attached to this node which has the name “key”, if it
exists.</p>

<p>The key name is matched case insensitively.</p>

<p>Note that to get the default key, you should pass the empty string “” here.
The default key is often written “@”, but inside hives that has no meaning
and won&#39;t give you the default key.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_get_value[http://libguestfs.org/hivex.3.html#hivex_node_get_value]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_get_value-source">
            <pre>static VALUE
ruby_hivex_node_get_value (VALUE hv, VALUE nodev, VALUE keyv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_get_value&quot;);
  hive_node_h node = NUM2ULL (nodev);
  const char *key = StringValueCStr (keyv);

  hive_value_h r;

  r = hivex_node_get_value (h, node, key);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_name" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_name(node) &rarr; string
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the name of the node</p>

<p>Return the name of the node.</p>

<p>Note that the name of the root node is a dummy, such as “$$$PROTO.HIV”
(other names are possible: it seems to depend on the tool or program that
created the hive in the first place). You can only know the “real” name of
the root node by knowing which registry file this hive originally comes
from, which is knowledge that is outside the scope of this library.</p>

<p>The name is recoded to UTF-8 and may contain embedded NUL characters.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_name[http://libguestfs.org/hivex.3.html#hivex_node_name]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_name-source">
            <pre>static VALUE
ruby_hivex_node_name (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_name&quot;);
  hive_node_h node = NUM2ULL (nodev);

  char *r;

  r = hivex_node_name (h, node);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  size_t sz = hivex_node_name_len (h, node);
  VALUE rv = rb_str_new (r, sz);
#ifdef HAVE_RUBY_ENCODING_H
  rb_enc_associate (rv, rb_utf8_encoding ());
#endif
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_name_len" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_name_len(node) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the length of a node&#39;s name</p>

<p>Return the length of the node name as produced by “h.node_name”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_name_len[http://libguestfs.org/hivex.3.html#hivex_node_name_len]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_name_len-source">
            <pre>static VALUE
ruby_hivex_node_name_len (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_name_len&quot;);
  hive_node_h node = NUM2ULL (nodev);

  size_t r;

  r = hivex_node_name_len (h, node);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_parent" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_parent(node) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the parent of node</p>

<p>Return the parent of “node”.</p>

<p>The parent pointer of the root node in registry files that we have examined
seems to be invalid, and so this function will return an error if called on
the root node.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_parent[http://libguestfs.org/hivex.3.html#hivex_node_parent]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_parent-source">
            <pre>static VALUE
ruby_hivex_node_parent (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_parent&quot;);
  hive_node_h node = NUM2ULL (nodev);

  hive_node_h r;

  r = hivex_node_parent (h, node);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_set_value" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_set_value(node, val) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>set a single (key, value) pair at a given node</p>

<p>This call can be used to replace a single “(key, value)” pair stored in
“node”. If the key does not already exist, then a new key is added. Key
matching is case insensitive.</p>

<p>“node” is the node to modify.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_set_value[http://libguestfs.org/hivex.3.html#hivex_node_set_value]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_set_value-source">
            <pre>static VALUE
ruby_hivex_node_set_value (VALUE hv, VALUE nodev, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_set_value&quot;);
  hive_node_h node = NUM2ULL (nodev);
  hive_set_value val;
  get_value (valv, &amp;val);

  int r;

  r = hivex_node_set_value (h, node, &amp;val, 0);

  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_set_values" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_set_values(node, values) &rarr; nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>set (key, value) pairs at a node</p>

<p>This call can be used to set all the (key, value) pairs stored in “node”.</p>

<p>“node” is the node to modify.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_set_values[http://libguestfs.org/hivex.3.html#hivex_node_set_values]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_set_values-source">
            <pre>static VALUE
ruby_hivex_node_set_values (VALUE hv, VALUE nodev, VALUE valuesv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_set_values&quot;);
  hive_node_h node = NUM2ULL (nodev);
  size_t nr_values;
  hive_set_value *values;
  values = get_values (valuesv, &amp;nr_values);

  int r;

  r = hivex_node_set_values (h, node, nr_values, values, 0);

  free (values);
  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return Qnil;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_struct_length" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_struct_length(node) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the length of a node</p>

<p>Return the length of the node data structure.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_struct_length[http://libguestfs.org/hivex.3.html#hivex_node_struct_length]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_struct_length-source">
            <pre>static VALUE
ruby_hivex_node_struct_length (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_struct_length&quot;);
  hive_node_h node = NUM2ULL (nodev);

  size_t r;

  r = hivex_node_struct_length (h, node);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_timestamp" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_timestamp(node) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the modification time of the node</p>

<p>Return the modification time of the node.</p>

<p>The returned value is a Windows filetime. To convert this to a Unix
“time_t” see: &lt;<a
href="http://stackoverflow.com/questions/6161776/convert-wind">stackoverflow.com/questions/6161776/convert-wind</a>
ows-filetime-to-second-in-unix-linux/6161842#6161842&gt;</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_timestamp[http://libguestfs.org/hivex.3.html#hivex_node_timestamp]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_timestamp-source">
            <pre>static VALUE
ruby_hivex_node_timestamp (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_timestamp&quot;);
  hive_node_h node = NUM2ULL (nodev);

  errno = 0;
  int64_t r;

  r = hivex_node_timestamp (h, node);

  if (r == -1 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-node_values" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            node_values(node) &rarr; list
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return (key, value) pairs attached to a node</p>

<p>Return the array of (key, value) pairs attached to this node.</p>

<p>(For the C API documentation for this function, see
<code>hivex_node_values[http://libguestfs.org/hivex.3.html#hivex_node_values]</code>).</p>
          
          

          
          <div class="method-source-code" id="node_values-source">
            <pre>static VALUE
ruby_hivex_node_values (VALUE hv, VALUE nodev)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;node_values&quot;);
  hive_node_h node = NUM2ULL (nodev);

  hive_value_h *r;

  r = hivex_node_values (h, node);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  size_t i, len = 0;
  for (i = 0; r[i] != 0; ++i) len++;
  VALUE rv = rb_ary_new2 (len);
  for (i = 0; r[i] != 0; ++i)
    rb_ary_push (rv, ULL2NUM (r[i]));
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-root" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            root() &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the root node of the hive</p>

<p>Return root node of the hive. All valid hives must contain a root node.</p>

<p>(For the C API documentation for this function, see
<code>hivex_root[http://libguestfs.org/hivex.3.html#hivex_root]</code>).</p>
          
          

          
          <div class="method-source-code" id="root-source">
            <pre>static VALUE
ruby_hivex_root (VALUE hv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;root&quot;);

  hive_node_h r;

  r = hivex_root (h);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_data_cell_offset" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_data_cell_offset(val) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the offset and length of a value data cell</p>

<p>Return the offset and length of the value&#39;s data cell.</p>

<p>The data cell is a registry structure that contains the length (a 4 byte,
little endian integer) followed by the data.</p>

<p>If the length of the value is less than or equal to 4 bytes then the offset
and length returned by this function is zero as the data is inlined in the
value.</p>

<p>Returns 0 and sets errno on error.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_data_cell_offset[http://libguestfs.org/hivex.3.html#hivex_value_data_cell_offset]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_data_cell_offset-source">
            <pre>static VALUE
ruby_hivex_value_data_cell_offset (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_data_cell_offset&quot;);
  hive_value_h val = NUM2ULL (valv);

  errno = 0;
  hive_value_h r;
  size_t len;

  r = hivex_value_data_cell_offset (h, val, &amp;len);

  if (r == 0 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  VALUE rv = rb_hash_new ();
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;len&quot;)), INT2NUM (len));
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;off&quot;)), ULL2NUM (r));
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_dword" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_dword(val) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return value as a DWORD</p>

<p>If this value is a DWORD (Windows int32), return it. This only works for
values which have type “hive_t_dword” or “hive_t_dword_be”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_dword[http://libguestfs.org/hivex.3.html#hivex_value_dword]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_dword-source">
            <pre>static VALUE
ruby_hivex_value_dword (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_dword&quot;);
  hive_value_h val = NUM2ULL (valv);

  errno = 0;
  int32_t r;

  r = hivex_value_dword (h, val);

  if (r == -1 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return INT2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_key" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_key(val) &rarr; string
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the key of a (key, value) pair</p>

<p>Return the key (name) of a (key, value) pair. The name is reencoded as
UTF-8 and returned as a string.</p>

<p>The string should be freed by the caller when it is no longer needed.</p>

<p>Note that this function can return a zero-length string. In the context of
Windows Registries, this means that this value is the default key for this
node in the tree. This is usually written as “@”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_key[http://libguestfs.org/hivex.3.html#hivex_value_key]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_key-source">
            <pre>static VALUE
ruby_hivex_value_key (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_key&quot;);
  hive_value_h val = NUM2ULL (valv);

  char *r;

  r = hivex_value_key (h, val);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  size_t sz = hivex_value_key_len (h, val);
  VALUE rv = rb_str_new (r, sz);
#ifdef HAVE_RUBY_ENCODING_H
  rb_enc_associate (rv, rb_utf8_encoding ());
#endif
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_key_len" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_key_len(val) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the length of a value&#39;s key</p>

<p>Return the length of the key (name) of a (key, value) pair as produced by
“h.value_key”. The length can legitimately be 0, so errno is the necessary
mechanism to check for errors.</p>

<p>In the context of Windows Registries, a zero-length name means that this
value is the default key for this node in the tree. This is usually written
as “@”.</p>

<p>The key is recoded to UTF-8 and may contain embedded NUL characters.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_key_len[http://libguestfs.org/hivex.3.html#hivex_value_key_len]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_key_len-source">
            <pre>static VALUE
ruby_hivex_value_key_len (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_key_len&quot;);
  hive_value_h val = NUM2ULL (valv);

  size_t r;

  r = hivex_value_key_len (h, val);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_multiple_strings" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_multiple_strings(val) &rarr; list
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return value as multiple strings</p>

<p>If this value is a multiple-string, return the strings reencoded as UTF-8
(in C, as a NULL-terminated array of C strings, in other language bindings,
as a list of strings). This only works for values which have type
“hive_t_multiple_strings”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_multiple_strings[http://libguestfs.org/hivex.3.html#hivex_value_multiple_strings]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_multiple_strings-source">
            <pre>static VALUE
ruby_hivex_value_multiple_strings (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_multiple_strings&quot;);
  hive_value_h val = NUM2ULL (valv);

  char **r;

  r = hivex_value_multiple_strings (h, val);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  size_t i, len = 0;
  for (i = 0; r[i] != NULL; ++i) len++;
  VALUE rv = rb_ary_new2 (len);
  for (i = 0; r[i] != NULL; ++i) {
    rb_ary_push (rv, rb_str_new2 (r[i]));
    free (r[i]);
  }
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_qword" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_qword(val) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return value as a QWORD</p>

<p>If this value is a QWORD (Windows int64), return it. This only works for
values which have type “hive_t_qword”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_qword[http://libguestfs.org/hivex.3.html#hivex_value_qword]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_qword-source">
            <pre>static VALUE
ruby_hivex_value_qword (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_qword&quot;);
  hive_value_h val = NUM2ULL (valv);

  errno = 0;
  int64_t r;

  r = hivex_value_qword (h, val);

  if (r == -1 &amp;&amp; errno != 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_string" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_string(val) &rarr; string
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return value as a string</p>

<p>If this value is a string, return the string reencoded as UTF-8 (as a C
string). This only works for values which have type “hive_t_string”,
“hive_t_expand_string” or “hive_t_link”.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_string[http://libguestfs.org/hivex.3.html#hivex_value_string]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_string-source">
            <pre>static VALUE
ruby_hivex_value_string (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_string&quot;);
  hive_value_h val = NUM2ULL (valv);

  char *r;

  r = hivex_value_string (h, val);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  VALUE rv = rb_str_new2 (r);
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_struct_length" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_struct_length(val) &rarr; integer
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return the length of a value data structure</p>

<p>Return the length of the value data structure.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_struct_length[http://libguestfs.org/hivex.3.html#hivex_value_struct_length]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_struct_length-source">
            <pre>static VALUE
ruby_hivex_value_struct_length (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_struct_length&quot;);
  hive_value_h val = NUM2ULL (valv);

  size_t r;

  r = hivex_value_struct_length (h, val);

  if (r == 0)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  return ULL2NUM (r);
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_type" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_type(val) &rarr; hash
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return data length and data type of a value</p>

<p>Return the data length and data type of the value in this (key, value)
pair. See also “h.value_value” which returns all this information, and the
value itself. Also, “h.value_*” functions below which can be used to return
the value in a more useful form when you know the type in advance.</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_type[http://libguestfs.org/hivex.3.html#hivex_value_type]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_type-source">
            <pre>static VALUE
ruby_hivex_value_type (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_type&quot;);
  hive_value_h val = NUM2ULL (valv);

  int r;
  size_t len;
  hive_type t;

  r = hivex_value_type (h, val, &amp;t, &amp;len);

  if (r == -1)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  VALUE rv = rb_hash_new ();
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;len&quot;)), INT2NUM (len));
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;type&quot;)), INT2NUM (t));
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-value_value" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            value_value(val) &rarr; hash
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>return data length, data type and data of a value</p>

<p>Return the value of this (key, value) pair. The value should be interpreted
according to its type (see “hive_type”).</p>

<p>(For the C API documentation for this function, see
<code>hivex_value_value[http://libguestfs.org/hivex.3.html#hivex_value_value]</code>).</p>
          
          

          
          <div class="method-source-code" id="value_value-source">
            <pre>static VALUE
ruby_hivex_value_value (VALUE hv, VALUE valv)
{
  hive_h *h;
  Data_Get_Struct (hv, hive_h, h);
  if (!h)
    rb_raise (rb_eArgError, &quot;%s: used handle after closing it&quot;,
              &quot;value_value&quot;);
  hive_value_h val = NUM2ULL (valv);

  char *r;
  size_t len;
  hive_type t;

  r = hivex_value_value (h, val, &amp;t, &amp;len);

  if (r == NULL)
    rb_raise (e_Error, &quot;%s&quot;, strerror (errno));

  VALUE rv = rb_hash_new ();
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;len&quot;)), INT2NUM (len));
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;type&quot;)), INT2NUM (t));
  rb_hash_aset (rv, ID2SYM (rb_intern (&quot;value&quot;)), rb_str_new (r, len));
  free (r);
  return rv;
}</pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

